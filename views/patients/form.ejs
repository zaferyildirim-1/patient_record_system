<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title><%= title %></title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <%- include('../partials/topbar') %>
  <header>
    <h1><%= title %></h1>
    <p>Temel hasta bilgilerini düzenleyin</p>
  </header>
  <main>
    <div class="toolbar">
      <a class="button secondary" href="/">Ana Sayfa</a>
      <a class="button secondary" href="/patients">Listeye Dön</a>
    </div>

    <% if (errors.length) { %>
      <div class="alert">
        Lütfen zorunlu alanları doldurun: <%= errors.join(', ') %>
      </div>
    <% } %>

    <% if (patient && patient.patient_code) { %>
      <div class="info-badge">
        Bu hasta için kod: <span><%= patient.patient_code %></span>
      </div>
    <% } %>

    <form action="<%= action %>" method="<%= method %>">
      <h3>Kişisel Bilgiler</h3>
      <div>
        <label for="full_name">Ad Soyad *</label>
        <input type="text" id="full_name" name="full_name" value="<%= patient?.full_name || '' %>" required>
      </div>

      <div class="form-grid">
        <div>
          <label for="age">Yaş *</label>
          <input type="number" id="age" name="age" value="<%= patient?.age || '' %>" min="0" max="150" required>
        </div>
        <div>
          <label for="birth_date">Doğum Tarihi</label>
          <input type="date" id="birth_date" name="birth_date" value="<%= patient?.birth_date || '' %>" lang="tr-TR">
        </div>
      </div>

      <div>
        <label for="phone_number">Cep Numarası</label>
        <input type="tel" id="phone_number" name="phone_number" value="<%= patient?.phone_number || '' %>" placeholder="+90 XXX XXX XXXX">
      </div>

      <h3>Sağlık Bilgileri</h3>
      <div>
        <label for="chronic_conditions">Kronik Hastalıklar <small>(her biri yeni satırda)</small></label>
        <textarea id="chronic_conditions" name="chronic_conditions" rows="3" placeholder="Örn: Hipertansiyon&#10;Diyabet&#10;Tiroit hastalığı"><%= patient?.chronic_conditions?.join('\n') || '' %></textarea>
      </div>

      <div>
        <label for="medications">İlaçlar <small>(her biri yeni satırda)</small></label>
        <textarea id="medications" name="medications" rows="3" placeholder="Örn: Metoprol 100mg&#10;Aspirin 100mg"><%= patient?.medications?.join('\n') || '' %></textarea>
      </div>

      <div>
        <label for="allergies">Alerji/İlaç Intoleransı <small>(her biri yeni satırda)</small></label>
        <textarea id="allergies" name="allergies" rows="3" placeholder="Örn: Penisilin&#10;Sulfonamidler"><%= patient?.allergies?.join('\n') || '' %></textarea>
      </div>

      <div>
        <label for="past_surgeries">Geçmiş Operasyonlar <small>(her biri yeni satırda)</small></label>
        <textarea id="past_surgeries" name="past_surgeries" rows="3" placeholder="Örn: Apendektomi (2015)&#10;Sezaryen (2018)"><%= patient?.past_surgeries?.join('\n') || '' %></textarea>
      </div>

      <h3>Acil Durum Kişi</h3>
      <div class="form-grid">
        <div>
          <label for="emergency_contact_name">Ad Soyad</label>
          <input type="text" id="emergency_contact_name" name="emergency_contact_name" value="<%= patient?.emergency_contact_name || '' %>" placeholder="Acil durum kişisinin adı">
        </div>
        <div>
          <label for="emergency_contact_phone">Telefon</label>
          <input type="tel" id="emergency_contact_phone" name="emergency_contact_phone" value="<%= patient?.emergency_contact_phone || '' %>" placeholder="+90 XXX XXX XXXX">
        </div>
      </div>

      <button type="submit">Kaydet</button>
    </form>
  </main>
